groups:
- name: mcp-observability
  rules:
  - alert: MCPHighErrorRate
    expr: sum(rate(mcp_requests_total{status="error"}[5m])) / sum(rate(mcp_requests_total[5m])) > 0.05
    for: 5m
    labels: { severity: warning }
    annotations:
      summary: "MCP error rate > 5% (5m)"
      description: "Error rate for MCP server {{ $labels.server_name }} is {{ $value | humanizePercentage }}"
  
  - alert: MCPLatencyP95TooHigh
    expr: histogram_quantile(0.95, sum by (le, server_name) (rate(mcp_request_duration_seconds_bucket[10m]))) > 5
    for: 10m
    labels: { severity: warning }
    annotations:
      summary: "MCP p95 latency > 5s (10m)"
      description: "P95 latency for {{ $labels.server_name }} is {{ $value }}s"
  
  - alert: MCPUpstreamDown
    expr: mcp_upstream_available == 0
    for: 2m
    labels: { severity: critical }
    annotations:
      summary: "MCP upstream server is DOWN"
      description: "Upstream server {{ $labels.server_name }} is not responding"
  
  - alert: CollectorDown
    expr: absent(up{job="otelcol-sidecar"} == 1)
    for: 2m
    labels: { severity: critical }
    annotations:
      summary: "OTel Collector sidecar is DOWN"
      description: "The OpenTelemetry Collector is not responding"
